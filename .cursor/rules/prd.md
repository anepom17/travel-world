# PRD: Travel World ‚Äî –î–Ω–µ–≤–Ω–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞

**–ù–∞–∑–≤–∞–Ω–∏–µ:** Travel World (—Ä–∞–±–æ—á–µ–µ)
**–°—É—Ç—å:** –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–æ–π –º–∏—Ä–∞, —Ñ–æ—Ç–æ–∞–ª—å–±–æ–º–∞–º–∏ –ø–æ–µ–∑–¥–æ–∫ –∏ –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç–æ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞.
**–°—Ç–µ–∫:** Next.js 14+ (App Router) ¬∑ TypeScript ¬∑ Tailwind CSS ¬∑ shadcn/ui ¬∑ Supabase (Auth + DB + Storage) ¬∑ Vercel ¬∑ LLM API (Gemini / Claude / OpenAI ‚Äî –Ω–∞ –≤—ã–±–æ—Ä)
**–¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ MVP:** 1‚Äì2 –¥–Ω—è

---

## 2. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

–õ—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –ª—é–±—è—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —Ö–æ—Ç—è—Ç –≤–µ—Å—Ç–∏ –≤–∏–∑—É–∞–ª—å–Ω—É—é —Ö—Ä–æ–Ω–∏–∫—É –ø–æ–µ–∑–¥–æ–∫ ‚Äî –æ—Ç ¬´–æ—Ç–º–µ—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ¬ª –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ–¥–Ω–µ–≤–Ω–∏–∫–∞. MVP –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (personal tool), –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤.

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (MVP)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: ¬´–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ–µ–∑–¥–∫—É¬ª
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç ‚Üí –≤–∏–¥–∏—Ç –∫–∞—Ä—Ç—É –º–∏—Ä–∞ ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–î–æ–±–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥–∫—É¬ª ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞–Ω—É, —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—Ç—ã, –ø–∏—à–µ—Ç –∑–∞–º–µ—Ç–∫—É ‚Üí —Å—Ç—Ä–∞–Ω–∞ –∑–∞–∫—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ.

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ¬ª
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–µ–∑–¥–∫–∏ ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ‚Üí –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≥–∞–ª–µ—Ä–µ–µ–π –≤–Ω—É—Ç—Ä–∏ –ø–æ–µ–∑–¥–∫–∏.

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: ¬´–£–∑–Ω–∞—Ç—å —Å–µ–±—è –∫–∞–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞¬ª
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–ú–æ–π –ø–æ—Ä—Ç—Ä–µ—Ç¬ª ‚Üí –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–µ–∑–¥–∫–∏, –∑–∞–º–µ—Ç–∫–∏, –≥–µ–æ–≥—Ä–∞—Ñ–∏—é ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç —Å –∞—Ä—Ö–µ—Ç–∏–ø–æ–º, –∏–Ω—Å–∞–π—Ç–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –∫—É–¥–∞ –ø–æ–µ—Ö–∞—Ç—å –¥–∞–ª—å—à–µ.

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É¬ª
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω, –ø—Ä–æ—Ü–µ–Ω—Ç –º–∏—Ä–∞, –ø–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã, —Ç–∞–π–º–ª–∞–π–Ω –ø–æ–µ–∑–¥–æ–∫.

---

## 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è MVP

### 4.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- **–§–∞–∑–∞ 1 (–î–µ–Ω—å 1):** Email/password —á–µ—Ä–µ–∑ Supabase Auth ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–§–∞–∑–∞ 2 (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è):** –î–æ–±–∞–≤–∏—Ç—å Google OAuth, –∫–æ–≥–¥–∞ –∏–∑–≤–µ—Å—Ç–µ–Ω production-–¥–æ–º–µ–Ω
- –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤ ‚Äî –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ª–µ–Ω–¥–∏–Ω–≥
- –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥

**Google OAuth (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Vercel):**
- –í Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials ‚Üí OAuth 2.0 Client
- Authorized redirect URIs:
  - –î–µ–≤: `http://localhost:3000/auth/callback`
  - –ü—Ä–æ–¥: `https://<your-app>.vercel.app/auth/callback`
- –í Supabase Dashboard ‚Üí Authentication ‚Üí Providers ‚Üí Google ‚Üí –≤—Å—Ç–∞–≤–∏—Ç—å Client ID –∏ Secret
- **–í–∞–∂–Ω–æ:** redirect URI –≤ Google Console, –≤ Supabase –∏ –≤ –∫–æ–¥–µ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–∏–º–≤–æ–ª –≤ —Å–∏–º–≤–æ–ª. –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (http/https, trailing slash) ‚Äî —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–æ–∫ OAuth.

### 4.2 –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –º–∏—Ä–∞ (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `react-simple-maps`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–∞—Ä—Ç—ã:** npm-–ø–∞–∫–µ—Ç `world-atlas`, —Ñ–∞–π–ª `countries-110m.json`

‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω–æ: –º–∞–ø–ø–∏–Ω–≥ –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω**
TopoJSON –∏–∑ `world-atlas` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—á–∏—Å–ª–æ–≤—ã–µ ISO 3166-1 numeric** –∫–æ–¥—ã –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö —Å—Ç—Ä–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `643` –¥–ª—è –†–æ—Å—Å–∏–∏, `840` –¥–ª—è –°–®–ê). –ù–∞—à–∞ –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **alpha-2** –∫–æ–¥—ã (`RU`, `US`). –ù–µ–æ–±—Ö–æ–¥–∏–º —Å–ª–æ–≤–∞—Ä—å –º–∞–ø–ø–∏–Ω–≥–∞ numeric ‚Üí alpha-2.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è: —Ñ–∞–π–ª `lib/constants/country-codes.ts` —Å –º–∞–ø–ø–∏–Ω–≥–æ–º:
```typescript
// numeric ISO ‚Üí alpha-2 ISO
export const NUMERIC_TO_ALPHA2: Record<string, string> = {
  "004": "AF", // Afghanistan
  "008": "AL", // Albania
  // ... –≤—Å–µ ~195 —Å—Ç—Ä–∞–Ω
  "643": "RU", // Russia
  "840": "US", // United States
};
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç—ã:**
- –ü–æ—Å–µ—â—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –∑–∞–∫—Ä–∞—à–µ–Ω—ã –∞–∫—Ü–µ–Ω—Ç–Ω—ã–º —Ü–≤–µ—Ç–æ–º
- Hover-—ç—Ñ—Ñ–µ–∫—Ç —Å —Ç—É–ª—Ç–∏–ø–æ–º (–Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã)
- –ö–ª–∏–∫ –ø–æ –∑–∞–∫—Ä–∞—à–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–µ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ–µ–∑–¥–æ–∫ –≤ —ç—Ç—É —Å—Ç—Ä–∞–Ω—É
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥ –∫–∞—Ä—Ç–æ–π: ¬´X —Å—Ç—Ä–∞–Ω ¬∑ Y% –º–∏—Ä–∞ ¬∑ Z –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–æ–≤¬ª

**Fallback-–ø–ª–∞–Ω:** –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –∏–ª–∏ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–æ–º ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω —Å —Ñ–ª–∞–≥–∞–º–∏ (emoji) –≤ –≤–∏–¥–µ —Å–µ—Ç–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫. –ö–∞—Ä—Ç—É –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–∑–∂–µ. –ù–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ –±–æ–ª—å—à–µ 3 —á–∞—Å–æ–≤.

### 4.3 CRUD –ø–æ–µ–∑–¥–æ–∫ (Trips)

- **–°–æ–∑–¥–∞–Ω–∏–µ:** —Ñ–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏ ‚Äî —Å—Ç—Ä–∞–Ω–∞ (–≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ —Å –ø–æ–∏—Å–∫–æ–º), –≥–æ—Ä–æ–¥ (—Ç–µ–∫—Å—Ç, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞/–∫–æ–Ω—Ü–∞, –∑–∞–º–µ—Ç–∫–∞ (textarea), –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–≤—ã–±–æ—Ä —ç–º–æ–¥–∑–∏: ü§© üòä üòê üò§ üò¢)
- **–ü—Ä–æ—Å–º–æ—Ç—Ä:** –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–µ–∑–¥–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π + —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–µ–π
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –≤—Å–µ –ø–æ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã
- **–£–¥–∞–ª–µ–Ω–∏–µ:** —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º. **–í–∞–∂–Ω–æ ‚Äî –ø–æ—Ä—è–¥–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è:**
  1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ `storage_path` –≤—Å–µ—Ö —Ñ–æ—Ç–æ –ø–æ–µ–∑–¥–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `photos`
  2. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ Supabase Storage –ø–∞–∫–µ—Ç–Ω—ã–º –≤—ã–∑–æ–≤–æ–º (`supabase.storage.from('trip-photos').remove([...paths])`)
  3. –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å trip –∏–∑ –ë–î (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª–∏—Ç –∑–∞–ø–∏—Å–∏ –∏–∑ `photos`)
  4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ Server Action –∏–ª–∏ API route, **–Ω–µ** –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π delete
- **–°–ø–∏—Å–æ–∫:** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞—à–±–æ—Ä–¥–∞ ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–µ–∑–¥–æ–∫; –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–µ–∑–¥–∫–∞–º–∏ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)

### 4.4 –§–æ—Ç–æ–∞–ª—å–±–æ–º –ø–æ–µ–∑–¥–∫–∏

- **–õ–∏–º–∏—Ç:** –¥–æ 20 —Ñ–æ—Ç–æ –Ω–∞ –ø–æ–µ–∑–¥–∫—É
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ: `PhotoUploader` –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –µ—Å–ª–∏ `existingPhotos.length + newFiles.length > 20`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—ç–∫–µ (Server Action): `SELECT COUNT(*) FROM photos WHERE trip_id = $1` –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π
- Supabase Storage, **–ø—Ä–∏–≤–∞—Ç–Ω—ã–π** –±–∞–∫–µ—Ç `trip-photos`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—É—Ç–µ–π: `{user_id}/{trip_id}/{timestamp}_{filename}`
- **–î–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ç–æ: —á–µ—Ä–µ–∑ signed URLs**
  - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–µ–∑–¥–∫–∏ ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º signed URLs (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ 1 —á–∞—Å) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ç–æ
  - –ü–µ—Ä–µ–¥–∞—ë–º URLs –∫–ª–∏–µ–Ω—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å public URLs ‚Äî –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã
- –ü—Ä–µ–≤—å—é-—Å–µ—Ç–∫–∞ (grid) –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–µ–∑–¥–∫–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –≤ –ª–∞–π—Ç–±–æ–∫—Å–µ –ø–æ –∫–ª–∏–∫—É
- –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ
- –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: jpg, png, webp; –º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 5 MB
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π (nice-to-have)

**‚ö†Ô∏è –ê–≤–∞—Ä–∏–π–Ω—ã–π –ø–ª–∞–Ω Storage:** –ï—Å–ª–∏ RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ Storage —Å–æ–∑–¥–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–∞–∫–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–º (`public: true`), –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –±–∞–∫–µ—Ç—É –ø–æ—Å–ª–µ MVP.

### 4.5 –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞

- –ö–Ω–æ–ø–∫–∞ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç¬ª –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/portrait`
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö: –≤—Å–µ –ø–æ–µ–∑–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–∞–Ω—ã, –≥–æ—Ä–æ–¥–∞, –¥–∞—Ç—ã, –∑–∞–º–µ—Ç–∫–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è)
- –í—ã–∑–æ–≤ LLM API —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API route
- **–ú–æ–¥–µ–ª—å:** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `LLM_PROVIDER` (`gemini` | `claude` | `openai`). –ö–æ–¥ API route —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. –í MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä.
- –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî **—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å —Å–µ–∫—Ü–∏—è–º–∏-—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏** (–Ω–µ JSON ‚Äî LLM –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å JSON-—Ñ–æ—Ä–º–∞—Ç):

```
## –ê—Ä—Ö–µ—Ç–∏–ø
<–º–µ—Ç–∞—Ñ–æ—Ä–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞, 3-5 —Å–ª–æ–≤>

## –ê–Ω–∞–ª–∏–∑
<2-3 –∞–±–∑–∞—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∏–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö>

## –ò–Ω—Å–∞–π—Ç
<–æ–¥–Ω–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ>

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
<1-2 —Å—Ç—Ä–∞–Ω—ã –∫—É–¥–∞ —Å—Ç–æ–∏—Ç –ø–æ–µ—Ö–∞—Ç—å, —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º>
```

- **–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞:** —Ä–∞–∑–±–∏—Ç—å –ø–æ `## ` –Ω–∞ —Å–µ–∫—Ü–∏–∏, –∫–∞–∂–¥—É—é —Å–µ–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ UI. –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç —Ü–µ–ª–∏–∫–æ–º –∫–∞–∫ –µ–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ (graceful degradation).
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `ai_portraits`)
- –ö–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç¬ª ‚Äî –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 3 –ø–æ–µ–∑–¥–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ä–µ—Ç–∞¬ª –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ
- –õ–æ–∞–¥–µ—Ä –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (streaming –æ—Ç–≤–µ—Ç–∞ ‚Äî nice-to-have)

### 4.6 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
- –ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞ (–∏–∑ ~195)
- –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã (—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –ø–æ –∫–∞–∂–¥–æ–º—É)
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫
- –ü–µ—Ä–≤–∞—è –∏ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–µ–∑–¥–∫–∞
- –°–∞–º–∞—è –ø–æ—Å–µ—â–∞–µ–º–∞—è —Å—Ç—Ä–∞–Ω–∞

### 4.7 UI-—Å–æ—Å—Ç–æ—è–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 3 —Å–æ—Å—Ç–æ—è–Ω–∏—è:

- **Loading:** `Skeleton` –∏–∑ shadcn/ui ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
- **Empty state:** –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∏–ª–∏ –∏–∫–æ–Ω–∫–∞ + —Ç–µ–∫—Å—Ç + CTA-–∫–Ω–æ–ø–∫–∞. –ü—Ä–∏–º–µ—Ä—ã:
  - –î–∞—à–±–æ—Ä–¥ –±–µ–∑ –ø–æ–µ–∑–¥–æ–∫: ¬´–ö–∞—Ä—Ç–∞ –∂–¥—ë—Ç –≤–∞—à–∏—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π¬ª + –∫–Ω–æ–ø–∫–∞ ¬´–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –ø–æ–µ–∑–¥–∫—É¬ª
  - –ü–æ–µ–∑–¥–∫–∞ –±–µ–∑ —Ñ–æ—Ç–æ: ¬´–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è¬ª + –∫–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  - –ü–æ—Ä—Ç—Ä–µ—Ç –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö: ¬´–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 3 –ø–æ–µ–∑–¥–∫–∏¬ª + —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
- **Error state:** `Toast` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ + –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞¬ª –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ

---

## 5. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Supabase / PostgreSQL)

```sql
-- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- =============================================
-- –¢–ê–ë–õ–ò–¶–´
-- =============================================

-- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–º –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  display_name TEXT,
  avatar_url TEXT,
  bio TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ü–æ–µ–∑–¥–∫–∏
CREATE TABLE trips (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  country_code CHAR(2) NOT NULL,        -- ISO 3166-1 alpha-2 (–º–∞–ø–ø–∏–Ω–≥ –∫–∞—Ä—Ç—ã ‚Üí –ë–î —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å)
  country_name TEXT NOT NULL,            -- –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –¥–∂–æ–∏–Ω–æ–≤ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º)
  city TEXT,
  title TEXT,                            -- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏
  started_at DATE NOT NULL,
  ended_at DATE,
  notes TEXT,
  mood TEXT CHECK (mood IN ('amazing', 'good', 'neutral', 'tough', 'terrible')),
  is_public BOOLEAN DEFAULT FALSE,       -- –ó–∞–¥–µ–ª –¥–ª—è —Å–æ—Ü—Å–µ—Ç–∏
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
CREATE TABLE photos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  trip_id UUID NOT NULL REFERENCES trips(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  storage_path TEXT NOT NULL,            -- –ü—É—Ç—å –≤ Supabase Storage
  caption TEXT,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç—ã (–∫—ç—à)
CREATE TABLE ai_portraits (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  archetype TEXT,
  content TEXT NOT NULL,                 -- –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Ä—Ç—Ä–µ—Ç–∞
  trips_count INT,                       -- –°–∫–æ–ª—å–∫–æ –ø–æ–µ–∑–¥–æ–∫ –±—ã–ª–æ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  model_version TEXT,                    -- –ü—Ä–æ–≤–∞–π–¥–µ—Ä + –º–æ–¥–µ–ª—å ("gemini/gemini-2.0-flash" –∏ —Ç–ø)
  generated_at TIMESTAMPTZ DEFAULT NOW()
);

-- =============================================
-- –ò–ù–î–ï–ö–°–´
-- =============================================

CREATE INDEX idx_trips_user_id ON trips(user_id);
CREATE INDEX idx_trips_country ON trips(user_id, country_code);
CREATE INDEX idx_photos_trip_id ON photos(trip_id);
CREATE INDEX idx_ai_portraits_user ON ai_portraits(user_id);

-- =============================================
-- ROW LEVEL SECURITY
-- =============================================

ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE trips ENABLE ROW LEVEL SECURITY;
ALTER TABLE photos ENABLE ROW LEVEL SECURITY;
ALTER TABLE ai_portraits ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Users can CRUD own trips"
  ON trips FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users can CRUD own photos"
  ON photos FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users can CRUD own portraits"
  ON ai_portraits FOR ALL USING (auth.uid() = user_id);

-- =============================================
-- –¢–†–ò–ì–ì–ï–†: —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
-- =============================================

CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, display_name, avatar_url)
  VALUES (
    NEW.id,
    COALESCE(NEW.raw_user_meta_data->>'full_name', NEW.raw_user_meta_data->>'name', '–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫'),
    COALESCE(NEW.raw_user_meta_data->>'avatar_url', NEW.raw_user_meta_data->>'picture')
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- =============================================
-- STORAGE (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Supabase Dashboard)
-- =============================================

-- 1. –°–æ–∑–¥–∞—Ç—å –ü–†–ò–í–ê–¢–ù–´–ô –±–∞–∫–µ—Ç "trip-photos" (public = false)
-- 2. –î–æ–±–∞–≤–∏—Ç—å Storage-–ø–æ–ª–∏—Ç–∏–∫–∏:

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ—é –ø–∞–ø–∫—É
-- Bucket: trip-photos
-- Policy name: "Users upload to own folder"
-- Allowed operation: INSERT
-- Policy definition:
--   (bucket_id = 'trip-photos') AND
--   ((storage.foldername(name))[1] = auth.uid()::text)

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã
-- Bucket: trip-photos
-- Policy name: "Users read own files"
-- Allowed operation: SELECT
-- Policy definition:
--   (bucket_id = 'trip-photos') AND
--   ((storage.foldername(name))[1] = auth.uid()::text)

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã
-- Bucket: trip-photos
-- Policy name: "Users delete own files"
-- Allowed operation: DELETE
-- Policy definition:
--   (bucket_id = 'trip-photos') AND
--   ((storage.foldername(name))[1] = auth.uid()::text)

-- ‚ö†Ô∏è –ê–≤–∞—Ä–∏–π–Ω—ã–π –ø–ª–∞–Ω: –µ—Å–ª–∏ Storage RLS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç > 30 –º–∏–Ω,
-- –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç—å public = true –Ω–∞ –±–∞–∫–µ—Ç–µ –∏ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.
```

---

## 6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                    # Root layout, —à—Ä–∏—Ñ—Ç—ã, metadata
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                      # –õ–µ–Ω–¥–∏–Ω–≥ (–¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
‚îÇ   ‚îú‚îÄ‚îÄ globals.css
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/page.tsx            # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callback/route.ts         # OAuth callback
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ (protected)/                  # Layout —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π auth
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Sidebar/header + auth guard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/page.tsx        # –ö–∞—Ä—Ç–∞ –º–∏—Ä–∞ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trips/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # –í—Å–µ –ø–æ–µ–∑–¥–∫–∏ (—Å–ø–∏—Å–æ–∫)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ new/page.tsx          # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx          # –î–µ—Ç–∞–ª–∏ –ø–æ–µ–∑–¥–∫–∏ + —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ edit/page.tsx     # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ portrait/page.tsx         # –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/page.tsx         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (nice-to-have)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ ai/
‚îÇ           ‚îî‚îÄ‚îÄ portrait/route.ts     # POST: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ä–µ—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ map/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WorldMap.tsx              # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ trips/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TripCard.tsx              # –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–µ–∑–¥–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TripForm.tsx              # –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TripList.tsx              # –°–ø–∏—Å–æ–∫ –ø–æ–µ–∑–¥–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ photos/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PhotoUploader.tsx         # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–∞ 20)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PhotoGallery.tsx          # –°–µ—Ç–∫–∞ —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PhotoLightbox.tsx         # –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
‚îÇ   ‚îú‚îÄ‚îÄ portrait/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PortraitCard.tsx          # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç–∞ (–ø–∞—Ä—Å–∏–Ω–≥ —Å–µ–∫—Ü–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ stats/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatsPanel.tsx            # –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ui/                           # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.ts                 # Browser client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts                 # Server client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware.ts             # Auth middleware helpers
‚îÇ   ‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompts.ts               # –ü—Ä–æ–º–ø—Ç—ã (provider-agnostic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ provider.ts              # –ê–¥–∞–ø—Ç–µ—Ä: –≤—ã–±–æ—Ä LLM –ø–æ env
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parse-portrait.ts        # –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ —Å–µ–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ countries.ts              # –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω (code, name, nameEn, continent)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ country-codes.ts         # –ú–∞–ø–ø–∏–Ω–≥ ISO numeric ‚Üí alpha-2 (–¥–ª—è TopoJSON)
‚îÇ   ‚îú‚îÄ‚îÄ actions/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trips.ts                  # Server Actions (create, update, delete —Å Storage cleanup)
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts                      # –•–µ–ª–ø–µ—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                      # TypeScript —Ç–∏–ø—ã
‚îÇ
‚îî‚îÄ‚îÄ middleware.ts                      # Next.js middleware (auth redirect)
```

---

## 7. Middleware (auth)

–§–∞–π–ª `src/middleware.ts` ‚Äî –∑–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤:

```typescript
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Supabase auth session
  // –ï—Å–ª–∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
}

// ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ: matcher –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã
// –õ–µ–Ω–¥–∏–Ω–≥ (/), /login, /auth/callback ‚Äî –ù–ï –≤—Ö–æ–¥—è—Ç
export const config = {
  matcher: [
    '/dashboard/:path*',
    '/trips/:path*',
    '/portrait/:path*',
    '/settings/:path*',
  ],
};
```

---

## 8. API Routes

### POST `/api/ai/portrait`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ò–ò-–ø–æ—Ä—Ç—Ä–µ—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å auth (Supabase server client)
2. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–µ–∑–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–Ω–∏–º—É–º 3 –ø–æ–µ–∑–¥–∫–∏, –∏–Ω–∞—á–µ –≤–µ—Ä–Ω—É—Ç—å 400
4. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–µ–∑–¥–æ–∫
5. –í—ã–∑–≤–∞—Ç—å LLM API —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä (`lib/ai/provider.ts`)
6. –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ —Å–µ–∫—Ü–∏–∏ (`lib/ai/parse-portrait.ts`)
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `ai_portraits`
8. –í–µ—Ä–Ω—É—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

### LLM-–∞–¥–∞–ø—Ç–µ—Ä (`lib/ai/provider.ts`)

```typescript
// –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º LLM
// –ü—Ä–æ–≤–∞–π–¥–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ env LLM_PROVIDER

export type LLMProvider = 'gemini' | 'claude' | 'openai';

export async function generateText(
  systemPrompt: string,
  userPrompt: string
): Promise<string> {
  const provider = process.env.LLM_PROVIDER as LLMProvider || 'gemini';

  switch (provider) {
    case 'gemini':
      // Google Generative AI SDK
      // npm install @google/generative-ai
      break;
    case 'claude':
      // Anthropic SDK
      // npm install @anthropic-ai/sdk
      break;
    case 'openai':
      // OpenAI SDK
      // npm install openai
      break;
  }
}
```

### –ü—Ä–æ–º–ø—Ç (`lib/ai/prompts.ts`)

```typescript
export const PORTRAIT_SYSTEM_PROMPT = `–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π —Å –¥—É—à–æ–π –ø–æ—ç—Ç–∞. –ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
—Å–æ—Å—Ç–∞–≤—å —è—Ä–∫–∏–π, —Ç—ë–ø–ª—ã–π –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π "–ø–æ—Ä—Ç—Ä–µ—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞".

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî —Å—Ç—Ä–æ–≥–æ –ø–æ —Å–µ–∫—Ü–∏—è–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:

## –ê—Ä—Ö–µ—Ç–∏–ø
–ú–µ—Ç–∞—Ñ–æ—Ä–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ (3-5 —Å–ª–æ–≤)

## –ê–Ω–∞–ª–∏–∑
2-3 –∞–±–∑–∞—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∏–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π. –£–ø–æ–º–∏–Ω–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–µ–∑–¥–∫–∏, —Å—Ç—Ä–∞–Ω—ã, –¥–∞—Ç—ã.
–ò—â–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã: –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ —Å–µ–∑–æ–Ω–∞–º, —Ä–µ–≥–∏–æ–Ω–∞–º, —Ç–∏–ø—É –æ—Ç–¥—ã—Ö–∞.

## –ò–Ω—Å–∞–π—Ç
–û–¥–∏–Ω –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∏–Ω—Å–∞–π—Ç –∏–ª–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–∞–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫ –º–æ–≥ –Ω–µ –∑–∞–º–µ—Ç–∏—Ç—å.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
1-2 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω—ã —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –∏–∑ –¥–∞–Ω–Ω—ã—Ö.

–¢–æ–Ω: –∫–∞–∫ –º—É–¥—Ä—ã–π –¥—Ä—É–≥-–ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫, –Ω–µ –∫–∞–∫ —Ä–æ–±–æ—Ç. –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.`;

export function buildPortraitUserPrompt(trips: Trip[]): string {
  const countries = [...new Set(trips.map(t => t.country_name))];
  return `–í–æ—Ç –¥–∞–Ω–Ω—ã–µ –æ –º–æ–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö:

–ü–æ—Å–µ—â—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã: ${countries.join(', ')}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫: ${trips.length}

–î–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –ø–æ–µ–∑–¥–∫–∏:
${trips.map(t =>
  `- ${t.country_name}${t.city ? `, ${t.city}` : ''} | ${t.started_at} ‚Äî ${t.ended_at || '?'} | –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${t.mood || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'} | –ó–∞–º–µ—Ç–∫–∞: ${t.notes || '–Ω–µ—Ç'}`
).join('\n')}

–°–æ—Å—Ç–∞–≤—å –º–æ–π –ø–æ—Ä—Ç—Ä–µ—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞.`;
}
```

### –ü–∞—Ä—Å–µ—Ä –æ—Ç–≤–µ—Ç–∞ (`lib/ai/parse-portrait.ts`)

```typescript
export interface Portrait {
  archetype: string;
  analysis: string;
  insight: string;
  recommendation: string;
  raw: string; // –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
}

export function parsePortrait(text: string): Portrait {
  const raw = text;

  // –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ ## –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
  const sections = text.split(/^## /m).filter(Boolean);

  const getSection = (name: string): string => {
    const section = sections.find(s =>
      s.toLowerCase().startsWith(name.toLowerCase())
    );
    return section
      ? section.replace(/^.*\n/, '').trim()
      : '';
  };

  const archetype = getSection('–ê—Ä—Ö–µ—Ç–∏–ø');
  const analysis = getSection('–ê–Ω–∞–ª–∏–∑');
  const insight = getSection('–ò–Ω—Å–∞–π—Ç');
  const recommendation = getSection('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è');

  // Graceful degradation: –µ—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è,
  // PortraitCard –ø–æ–∫–∞–∂–µ—Ç raw —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏–∫–æ–º
  return { archetype, analysis, insight, recommendation, raw };
}
```

---

## 9. –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç—Ä–∞–Ω (–∫–∞—Ä—Ç–∞ ‚Üî –ë–î)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ–π –∏ –ë–î ‚Äî `country_code` (ISO 3166-1 alpha-2).

–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. **–ö–∞—Ä—Ç–∞ ‚Üí –ë–î:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –ø–æ —Å—Ç—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–µ ‚Üí TopoJSON –æ—Ç–¥–∞—ë—Ç `numeric` –∫–æ–¥ ‚Üí –º–∞–ø–ø–∏–Ω–≥ —á–µ—Ä–µ–∑ `NUMERIC_TO_ALPHA2` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º `alpha-2` –≤ –ë–î
2. **–ë–î ‚Üí –ö–∞—Ä—Ç–∞:** –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–µ–∑–¥–∫–∏ –∏–∑ –ë–î ‚Üí —Å–æ–±–∏—Ä–∞–µ–º Set –∏–∑ `country_code` ‚Üí –º–∞–ø–ø–∏–Ω–≥ —á–µ—Ä–µ–∑ `ALPHA2_TO_NUMERIC` ‚Üí –∑–∞–∫—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ

–§–∞–π–ª `lib/constants/country-codes.ts`:
```typescript
// ISO 3166-1 numeric ‚Üí alpha-2
export const NUMERIC_TO_ALPHA2: Record<string, string> = {
  "004": "AF",
  "008": "AL",
  // ... –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã
};

// –û–±—Ä–∞—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ –∫–∞—Ä—Ç—ã
export const ALPHA2_TO_NUMERIC: Record<string, string> =
  Object.fromEntries(
    Object.entries(NUMERIC_TO_ALPHA2).map(([k, v]) => [v, k])
  );
```

–§–∞–π–ª `lib/constants/countries.ts`:
```typescript
export interface Country {
  code: string;       // ISO 3166-1 alpha-2 ("JP", "FR")
  name: string;       // "–Ø–ø–æ–Ω–∏—è", "–§—Ä–∞–Ω—Ü–∏—è" (–¥–ª—è UI)
  nameEn: string;     // "Japan", "France" (–¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞ —Å TopoJSON name property)
  continent: string;  // "Asia", "Europe"
}

export const COUNTRIES: Country[] = [
  { code: "AF", name: "–ê—Ñ–≥–∞–Ω–∏—Å—Ç–∞–Ω", nameEn: "Afghanistan", continent: "Asia" },
  // ... –≤—Å–µ ~195 —Å—Ç—Ä–∞–Ω
];

export const TOTAL_COUNTRIES = 195;
export const CONTINENTS = [
  "Africa", "Asia", "Europe", "North America",
  "South America", "Oceania", "Antarctica"
];
```

---

## 10. –î–∏–∑–∞–π–Ω –∏ UI

### –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞
- **Primary:** Deep teal (#0D9488) ‚Äî –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è —Å –º–æ—Ä–µ–º, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏
- **Accent:** Warm amber (#F59E0B) ‚Äî —Ç—ë–ø–ª—ã–π, —Å–æ–ª–Ω–µ—á–Ω—ã–π
- **Background:** Slate-50 (#F8FAFC)
- **–ö–∞—Ä—Ç–∞ (–Ω–µ –ø–æ—Å–µ—â—ë–Ω–Ω—ã–µ):** Gray-200
- **–ö–∞—Ä—Ç–∞ (–ø–æ—Å–µ—â—ë–Ω–Ω—ã–µ):** Primary teal —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–∏–∑–∏—Ç–æ–≤
- **Moods:** ü§© Amazing ‚Üí –∑–æ–ª–æ—Ç–æ, üòä Good ‚Üí –∑–µ–ª—ë–Ω—ã–π, üòê Neutral ‚Üí —Å–µ—Ä—ã–π, üò§ Tough ‚Üí –æ—Ä–∞–Ω–∂–µ–≤—ã–π, üò¢ Terrible ‚Üí —Å–∏–Ω–∏–π

### –ú–∞–∫–µ—Ç
- **Desktop:** Sidebar (—Å–≤—ë—Ä–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) + –æ—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
- **–î–∞—à–±–æ—Ä–¥:** –ö–∞—Ä—Ç–∞ —Å–≤–µ—Ä—Ö—É (60% —ç–∫—Ä–∞–Ω–∞) + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-–±–∞—Ä + —Å–µ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–µ–∑–¥–æ–∫
- **–°—Ç–∏–ª—å:** –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, –º–Ω–æ–≥–æ –≤–æ–∑–¥—É—Ö–∞, —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –º—è–≥–∫–∏–µ —Ç–µ–Ω–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã shadcn/ui
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: Button, Card, Dialog, Input, Select, Textarea, Badge, Avatar, Skeleton, Toast, Tabs, DropdownMenu

---

## 11. Environment Variables

```env
# .env.local

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...             # –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞

# LLM (–≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
LLM_PROVIDER=gemini                           # "gemini" | "claude" | "openai"
GEMINI_API_KEY=AIza...                        # –ï—Å–ª–∏ LLM_PROVIDER=gemini
# ANTHROPIC_API_KEY=sk-ant-...               # –ï—Å–ª–∏ LLM_PROVIDER=claude
# OPENAI_API_KEY=sk-...                      # –ï—Å–ª–∏ LLM_PROVIDER=openai
```

---

## 12. –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—á–µ–∫–ª–∏—Å—Ç)

### –î–µ–Ω—å 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç
- [ ] `npx create-next-app@latest travel-world --typescript --tailwind --app`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase –ø—Ä–æ–µ–∫—Ç (—Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ Dashboard)
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL-–º–∏–≥—Ä–∞—Ü–∏—é (—Å—Ö–µ–º–∞ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 5)
- [ ] –°–æ–∑–¥–∞—Ç—å Storage bucket `trip-photos` (private) + –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 5
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Supabase Auth (**—Ç–æ–ª—å–∫–æ email/password** –Ω–∞ –¥–µ–Ω—å 1)
- [ ] Middleware —Å matcher —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã (—Ä–∞–∑–¥–µ–ª 7)
- [ ] Layout: header —Å –∞–≤–∞—Ç–∞—Ä–∫–æ–π –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—à–±–æ—Ä–¥–∞ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–æ–π –º–∏—Ä–∞ (‚ö†Ô∏è –ª–∏–º–∏—Ç: 3 —á–∞—Å–∞, –ø–æ—Ç–æ–º fallback)
- [ ] –ú–∞–ø–ø–∏–Ω–≥ country codes: numeric ‚Üî alpha-2 (—Ä–∞–∑–¥–µ–ª 9)
- [ ] CRUD –ø–æ–µ–∑–¥–æ–∫: —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è, —Å–ø–∏—Å–æ–∫, –∫–∞—Ä—Ç–æ—á–∫–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏ —á–µ—Ä–µ–∑ Server Action (—Å cleanup Storage)
- [ ] –°–≤—è–∑–∫–∞: –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–µ–∑–¥–∫–∏ –∫–∞—Ä—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### –î–µ–Ω—å 2: –ö–æ–Ω—Ç–µ–Ω—Ç + –ò–ò + –¥–µ–ø–ª–æ–π
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ: PhotoUploader —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–∞ 20 —à—Ç
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ signed URLs
- [ ] –õ–∞–π—Ç–±–æ–∫—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ
- [ ] –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
- [ ] LLM-–∞–¥–∞–ø—Ç–µ—Ä (`lib/ai/provider.ts`) + –ø—Ä–æ–º–ø—Ç + –ø–∞—Ä—Å–µ—Ä
- [ ] API route `/api/ai/portrait`
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/portrait` —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- [ ] UI: loading skeletons, empty states, error toasts
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ Vercel (–ø–æ–¥–∫–ª—é—á–∏—Ç—å GitHub-—Ä–µ–ø–æ, env variables)
- [ ] –î–æ–±–∞–≤–∏—Ç—å Google OAuth (—Ç–µ–ø–µ—Ä—å –¥–æ–º–µ–Ω –∏–∑–≤–µ—Å—Ç–µ–Ω)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–µ, —Ñ–∏–∫—Å –±–∞–≥–æ–≤

---

## 13. –ó–∞–¥–µ–ª –Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ MVP, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–æ—Å—Ç—è—Ç —Ä–æ—Å—Ç:

| –†–µ—à–µ–Ω–∏–µ –≤ MVP | –ß—Ç–æ –¥–∞—ë—Ç –≤ –±—É–¥—É—â–µ–º |
|---|---|
| `is_public` –Ω–∞ trips | –ü—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏, —à–µ—Ä–∏–Ω–≥, –ª–µ–Ω—Ç–∞ |
| `profiles` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ | –ü—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ `/u/username` |
| RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º |
| `country_code` (ISO alpha-2) | –î–∂–æ–∏–Ω—ã —Å –ª—é–±—ã–º –≥–µ–æ-API, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| `ai_portraits` —Å `model_version` | A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π, –∏—Å—Ç–æ—Ä–∏—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ |
| LLM-–∞–¥–∞–ø—Ç–µ—Ä —Å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π | –°–º–µ–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ |
| Storage path `{user_id}/{trip_id}/` | –ò–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |
| –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `/components` | –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ñ–∏—á |

### –ë—É–¥—É—â–∏–µ —Ñ–∏—á–∏ (–§–∞–∑–∞ 2+)
- –ò–ò-—ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥ –ø–æ —Ñ–æ—Ç–æ (Vision API)
- Wishlist —Å—Ç—Ä–∞–Ω –Ω–∞ –∫–∞—Ä—Ç–µ (–¥—Ä—É–≥–æ–π —Ü–≤–µ—Ç)
- –ë–µ–π–¥–∂–∏ –∏ –∞—á–∏–≤–∫–∏
- –ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å + —à–µ—Ä–∏–Ω–≥ –ø–æ —Å—Å—ã–ª–∫–µ
- –õ–µ–Ω—Ç–∞ –¥—Ä—É–∑–µ–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ª–∞–π–∫–∏
- –ò–ò-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF / —Ñ–æ—Ç–æ–∫–Ω–∏–≥—É
- –ò–º–ø–æ—Ä—Ç –∏–∑ Google Timeline

---

## 14. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å:** –ö–∞—Ä—Ç–∞ –º–∏—Ä–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è < 2 —Å–µ–∫—É–Ω–¥, —Ñ–æ—Ç–æ —Å–∂–∏–º–∞—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π (nice-to-have)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö, API –∫–ª—é—á–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (`LLM_PROVIDER`, `*_API_KEY`, `SUPABASE_SERVICE_ROLE_KEY` ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –≤ `NEXT_PUBLIC_*`), –≤–∞–ª–∏–¥–∞—Ü–∏—è inputs
- **SEO:** –õ–µ–Ω–¥–∏–Ω–≥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (–º–µ—Ç–∞—Ç–µ–≥–∏, OG image), –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî SPA-like
- **–õ–∏–º–∏—Ç—ã MVP:** –ú–∞–∫—Å 20 —Ñ–æ—Ç–æ –Ω–∞ –ø–æ–µ–∑–¥–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç + –±—ç–∫), –º–∞–∫—Å 5 MB –Ω–∞ —Ñ–æ—Ç–æ, –ø–æ—Ä—Ç—Ä–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ –º–∏–Ω—É—Ç—É
- **UI states:** –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç loading / empty / error —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Ä–∞–∑–¥–µ–ª 4.7)